<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë³µì§€ì—°ê¸ˆ ì§€ì› ì‹ ì²­ - LOFA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background: #f4f7f9; padding: 30px; font-family: 'Malgun Gothic', sans-serif; }
        .form-card { background: white; border-radius: 20px; padding: 40px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); max-width: 900px; margin: auto; }
        .section-title { border-left: 5px solid #ffc107; padding-left: 10px; margin-bottom: 20px; font-weight: bold; color: #333; }
        .info-box { background: #fffdf5; border: 1px solid #ffeeba; padding: 15px; border-radius: 10px; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container">
    <div class="form-card shadow">
        <h3 class="text-center fw-bold text-dark mb-5">
            {% if edit_mode %} <i class="bi bi-pencil-square"></i> ë³µì§€ì—°ê¸ˆ ì‹ ì²­ ë‚´ì—­ ìˆ˜ì • {% else %} ğŸ’° ì§ì› ë³µì§€ì—°ê¸ˆ ì§€ì› ì‹ ì²­ì„œ {% endif %}
        </h3>

        <form id="pensionForm" enctype="multipart/form-data">
            <input type="hidden" name="app_id" value="{{ data.app_id if edit_mode else '' }}">
            <input type="hidden" name="type" value="ë³µì§€ì—°ê¸ˆ">
            
            <div class="section-title">1. ì‹ ì²­ì¸ ì •ë³´</div>
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <label class="fw-bold small">ì„±ëª…</label>
                    <input type="text" name="user_name" class="form-control bg-light" value="{{ data.ì„±ëª… if data else user_name }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ì‚¬ë²ˆ</label>
                    <input type="text" name="user_id" class="form-control bg-light" value="{{ data.ì‚¬ë²ˆ if data else user_id }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ë¶€ì„œ</label>
                    <input type="text" name="user_dept" class="form-control bg-light" value="{{ data.ë¶€ì„œ if data else user_dept }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ì§ê¸‰</label>
                    <input type="text" name="position" class="form-control bg-light" value="{{ data.ì§ê¸‰ if data else user_rank }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ì…ì‚¬ì¼</label>
                    <input type="text" name="joinDate" class="form-control bg-light" value="{{ data.ì…ì‚¬ì¼ if data else user_join_date }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ì „í™”ë²ˆí˜¸</label>
                    <input type="text" name="phone" class="form-control" value="{{ data.ì „í™”ë²ˆí˜¸ if data else '' }}" placeholder="010-0000-0000" required>
                </div>
            </div>

            <div class="section-title">2. ì‹ ì²­ ìƒì„¸ ë‚´ìš©</div>
            <div class="row g-3 mb-4">
                <div class="col-md-6">
                    <label class="fw-bold small">ì§€ì› í•­ëª©</label>
                    <input type="text" name="item_name" class="form-control" 
                           value="{{ data.ì§€ì›í•­ëª© if edit_mode else '' }}" placeholder="ì˜ˆ: ê°œì¸ì—°ê¸ˆ, í‡´ì§ì—°ê¸ˆ ë“±" required>
                </div>
                
                <div class="col-md-6">
                    <label class="fw-bold small">ê¸ˆìœµê¸°ê´€</label>
                    <input type="text" name="bank_name" class="form-control" 
                           value="{{ data.ê¸ˆìœµê¸°ê´€ if edit_mode else '' }}" placeholder="ì˜ˆ: OOì€í–‰, XXì¦ê¶Œ" required>
                </div>

                <div class="col-md-4">
                    <label class="fw-bold small">ë³¸ì¸ ë¶€ë‹´ê¸ˆ</label>
                    <div class="input-group">
                        <input type="number" name="self_pay" class="form-control text-end" 
                               value="{{ data.ë³¸ì¸ë¶€ë‹´ if edit_mode else 0 }}" required>
                        <span class="input-group-text">ì›</span>
                    </div>
                </div>

                <div class="col-md-4">
                    <label class="fw-bold small text-primary">ì‹ ì²­ ê¸ˆì•¡</label>
                    <div class="input-group">
                        <input type="number" name="amount" class="form-control fw-bold text-end text-primary" 
                               value="{{ data.ì‹ ì²­ê¸ˆì•¡ if edit_mode else 0 }}" required>
                        <span class="input-group-text">ì›</span>
                    </div>
                </div>

                <div class="col-md-4">
                    <label class="fw-bold small">ì§€ê¸‰ ê³„ì¢Œ ì •ë³´</label>
                    <input type="text" name="account" class="form-control" 
                           value="{{ data.ê³„ì¢Œë²ˆí˜¸ if edit_mode else '' }}" placeholder="ì€í–‰/ê³„ì¢Œë²ˆí˜¸/ì˜ˆê¸ˆì£¼" required>
                </div>

                <div class="col-12 mt-3">
                    <label class="fw-bold small"><i class="bi bi-paperclip"></i> ì¦ë¹™ì„œë¥˜ ì²¨ë¶€ (ë‚©ì…ì¦ëª…ì„œ, í†µì¥ì‚¬ë³¸ ë“±)</label>
                    <input type="file" name="attachment" class="form-control">
                    {% if edit_mode and data.ì²¨ë¶€íŒŒì¼ %}
                    <div class="mt-2 small text-muted">ê¸°ì¡´ íŒŒì¼: <span class="text-primary">{{ data.ì²¨ë¶€íŒŒì¼ }}</span></div>
                    {% endif %}
                </div>
            </div>

            <div class="info-box mb-4">
                <i class="bi bi-info-circle-fill text-warning"></i> 
                <b>ì•ˆë‚´ì‚¬í•­:</b> ì—°ê¸ˆ ê°€ì… ì¦ëª… ë° ë³¸ì¸ ë¶€ë‹´ ë¶„ë‚©ì…ì„ ì¦ë¹™í•  ìˆ˜ ìˆëŠ” ìë£Œë¥¼ ë°˜ë“œì‹œ ì²¨ë¶€í•´ ì£¼ì„¸ìš”.
            </div>

            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-warning btn-lg shadow fw-bold text-dark">
                    {% if edit_mode %} <i class="bi bi-pencil-square"></i> ìˆ˜ì • ì™„ë£Œ ë° ì¬ì œì¶œ {% else %} <i class="bi bi-send-fill"></i> ë³µì§€ì—°ê¸ˆ ì‹ ì²­í•˜ê¸° {% endif %}
                </button>
                <a href="/my_status" class="btn btn-outline-secondary">ì·¨ì†Œí•˜ê³  ëŒì•„ê°€ê¸°</a>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById('pensionForm').onsubmit = async (e) => {
        e.preventDefault();
        
        // FormDataë¥¼ ì‚¬ìš©í•˜ë©´ í…ìŠ¤íŠ¸ì™€ íŒŒì¼ì´ í•œêº¼ë²ˆì— ì„œë²„ë¡œ ì „ì†¡ë©ë‹ˆë‹¤.
        const formData = new FormData(e.target);

        try {
            // ìˆ˜ì • ëª¨ë“œì™€ ì‹ ê·œ ì œì¶œ ëª¨ë‘ /submit ê²½ë¡œì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.
            const res = await fetch('/submit', { 
                method: 'POST', 
                body: formData 
            });
            
            const result = await res.json();
            
            if(result.status === 'success') {
                alert('ì‹ ì²­ì„œê°€ ì •ìƒì ìœ¼ë¡œ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = '/my_status'; 
            } else {
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + result.message);
            }
        } catch (err) { 
            alert('ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì„œë²„ ì‹¤í–‰ ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”.'); 
        }
    };
</script>
</body>
</html>