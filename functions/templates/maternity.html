<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ëª¨ì„±ë³´í˜¸ ì§€ì› ì‹ ì²­ - LOFA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f4f7f9; padding: 40px 0; font-family: 'Malgun Gothic', sans-serif; }
        .form-card { background: white; border-radius: 15px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); max-width: 800px; margin: auto; }
        .header-line { border-left: 5px solid #fd79a8; padding-left: 15px; margin-bottom: 30px; }
        .section-title { font-size: 1.1rem; font-weight: bold; color: #d63031; margin-top: 25px; margin-bottom: 15px; border-bottom: 2px solid #e9ecef; padding-bottom: 5px; }
        .info-text { background-color: #fff5f7; border-radius: 10px; padding: 15px; font-size: 0.9rem; color: #444; border: 1px solid #fab1a0; }
        .confidential-box { background-color: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; font-size: 0.85rem; color: #636e72; line-height: 1.6; }
    </style>
</head>
<body>
<div class="container">
    <div class="form-card shadow">
        <div class="header-line">
            <h2 class="fw-bold">{% if data and data.app_id %} ğŸ¤° ëª¨ì„±ë³´í˜¸ ì§€ì› ìˆ˜ì • {% else %} ğŸ¤° ëª¨ì„±ë³´í˜¸ ì§€ì› ì‹ ì²­ì„œ {% endif %}</h2>
            <p class="text-muted mb-0">ì„ì‹  ë° ë‚œì„ ì¹˜ë£Œ ì§€ì›ì„ ìœ„í•œ ì„ì§ì› ì „ìš© ì‹ ì²­ ì–‘ì‹ì…ë‹ˆë‹¤.</p>
        </div>

        <form id="maternityForm" enctype="multipart/form-data">
            <input type="hidden" name="app_id" value="{{ data.app_id if data and data.app_id else '' }}">
            <input type="hidden" name="type" value="ëª¨ì„±ë³´í˜¸ì§€ì›">

            <div class="section-title">1. ì‹ ì²­ì¸ ì •ë³´</div>
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <label class="fw-bold small">ì„±ëª…</label>
                    <input type="text" name="user_name" class="form-control bg-light" value="{{ data.ì„±ëª… if data else user_name }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ì‚¬ë²ˆ</label>
                    <input type="text" name="user_id" class="form-control bg-light" value="{{ data.ì‚¬ë²ˆ if data else user_id }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ë¶€ì„œ</label>
                    <input type="text" name="user_dept" class="form-control bg-light" value="{{ data.ë¶€ì„œ if data else user_dept }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ì§ê¸‰</label>
                    <input type="text" name="position" class="form-control bg-light" value="{{ data.ì§ê¸‰ if data else user_rank }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ì…ì‚¬ì¼</label>
                    <input type="text" name="joinDate" class="form-control bg-light" value="{{ data.ì…ì‚¬ì¼ if data else user_join_date }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ì „í™”ë²ˆí˜¸</label>
                    <input type="text" name="phone" class="form-control bg-light" value="{{ data.ì „í™”ë²ˆí˜¸ if data else '' }}" readonly required>
                </div>
            </div>

            <div class="section-title">2. ì§€ì› ì‹ ì²­ ë‚´ìš©</div>
            <div class="row g-3">
                <div class="col-md-12">
                    <label class="form-label fw-bold small">ì§€ì› í•­ëª© ì„ íƒ</label>
                    <select name="target_name" class="form-select" required>
                        <option value="" disabled {% if not data or not data.target_name %}selected{% endif %}>í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="ì„ì‹ ê´€ë ¨ ì§€ì›" {% if data and data.target_name == 'ì„ì‹ ê´€ë ¨ ì§€ì›' or (data.ëŒ€ìƒìì„±ëª… == 'ì„ì‹ ê´€ë ¨ ì§€ì›') %}selected{% endif %}>ì„ì‹  ê´€ë ¨ ì§€ì›</option>
                        <option value="ë‚œì„ ì¹˜ë£Œ ì§€ì›" {% if data and data.target_name == 'ë‚œì„ ì¹˜ë£Œ ì§€ì›' or (data.ëŒ€ìƒìì„±ëª… == 'ë‚œì„ ì¹˜ë£Œ ì§€ì›') %}selected{% endif %}>ë‚œì„ ì¹˜ë£Œ ì§€ì›</option>
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold small text-danger">ì‹ ì²­ ê¸ˆì•¡</label>
                    <div class="input-group">
                        <input type="number" name="amount" class="form-control fw-bold" value="{{ data.amount if data.amount else (data.ì‹ ì²­ê¸ˆì•¡ if data.ì‹ ì²­ê¸ˆì•¡ else 0) }}" required>
                        <span class="input-group-text">ì›</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold small">ì§€ê¸‰ ê³„ì¢Œë²ˆí˜¸</label>
                    <input type="text" name="account" class="form-control" value="{{ data.account if data.account else (data.ê³„ì¢Œë²ˆí˜¸ if data.ê³„ì¢Œë²ˆí˜¸ else '') }}" placeholder="ì€í–‰ëª… ë° ê³„ì¢Œë²ˆí˜¸" required>
                </div>

                <div class="col-12 mt-3">
                    <label class="form-label fw-bold small"><i class="bi bi-paperclip"></i> ì¦ë¹™ì„œë¥˜ ì²¨ë¶€ (ì„ì‹ í™•ì¸ì„œ, ë‚œì„ì§„ë‹¨ì„œ ë“±)</label>
                    <input type="file" name="attachment" class="form-control">
                    {% if data and data.ì²¨ë¶€íŒŒì¼ %}
                    <div class="mt-2 small text-muted">ê¸°ì¡´ íŒŒì¼: <span class="text-pink fw-bold" style="color:#fd79a8;">{{ data.ì²¨ë¶€íŒŒì¼ }}</span></div>
                    {% endif %}
                </div>
            </div>

            <div class="section-title">3. ì•ˆë‚´ì‚¬í•­ ë° ê·œì •</div>
            <div class="info-text mb-3">
                <i class="bi bi-file-earmark-medical"></i> <b>í•„ìˆ˜ ì¦ë¹™:</b> ì‚¬ì‹¤ í™•ì¸ì„ ìœ„í•œ ì¦ë¹™ ì„œë¥˜ë¥¼ ë°˜ë“œì‹œ ìŠ¤ìº”í•˜ì—¬ ì²¨ë¶€í•´ ì£¼ì„¸ìš”.
            </div>

            <div class="confidential-box mb-4 shadow-sm">
                <p class="mb-2 text-danger"><strong><i class="bi bi-shield-lock"></i> ê¸°ê¸ˆìš´ì˜ê·œì • ë¹„ë°€ìœ ì§€ ì•ˆë‚´</strong></p>
                <ul class="mb-0 small">
                    <li>ê¸°ê¸ˆìš´ì˜ê·œì • ì œ53ì¡°4í•­: ì„ì‹ ì‚¬ì‹¤ì´ ê°ê´€ì ìœ¼ë¡œ í™•ì¸ë˜ì–´ ì§€ì›ì´ ì´ë£¨ì–´ì§„ ê²½ìš° ì§€ì›ê¸ˆì„ í™˜ìˆ˜í•˜ì§€ ì•ŠìŒ</li>
                    <li>ê¸°ê¸ˆìš´ì˜ê·œì • ì œ59ì¡°: ì—…ë¬´ê´€ë ¨ìëŠ” ìˆ˜í–‰ ê³¼ì •ì—ì„œ ì•Œê²Œ ëœ ì •ë³´ë¥¼ ì ˆëŒ€ ëˆ„ì„¤í•˜ì—¬ì„œëŠ” ì•ˆ ë¨</li>
                </ul>
            </div>

            <div class="section-title" style="color:#fd79a8; border-bottom: 2px solid #fd79a8;">3. ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜</div>
            <div class="card mb-4 border-0 shadow-sm">
                <div class="card-body bg-light small" style="max-height: 150px; overflow-y: auto;">
                    <p class="fw-bold mb-1">[ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ëŒ€í•œ ë™ì˜]</p>
                    <p class="mb-2">LOFA ì‚¬ë‚´ê·¼ë¡œë³µì§€ê¸°ê¸ˆ ì§€ì› ì‹ ì²­ê³¼ ê´€ë ¨í•˜ì—¬ ì•„ë˜ì™€ ê°™ì´ ê·€í•˜ì˜ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘ ë° ì´ìš©í•˜ê³ ì í•©ë‹ˆë‹¤.</p>
                    <ul class="mb-2">
                        <li><strong>ìˆ˜ì§‘í•­ëª©:</strong> ì„±ëª…, ì‚¬ë²ˆ, ë¶€ì„œ, ì§ê¸‰, ì „í™”ë²ˆí˜¸, ì…ì‚¬ì¼, ê³„ì¢Œë²ˆí˜¸, ì‹ ì²­ ê¸ˆì•¡ ë° ì‚¬ìœ , ì¦ë¹™ì„œë¥˜ ë‚´ í¬í•¨ëœ ê°œì¸ì •ë³´</li>
                        <li><strong>ìˆ˜ì§‘ëª©ì :</strong> ë³µì§€ê¸°ê¸ˆ ì§€ì› ëŒ€ìƒ í™•ì¸, ì§€ê¸‰ ì‹¬ì‚¬ ë° ì²˜ë¦¬, ê²°ê³¼ í†µì§€, ê¸°ê¸ˆ ìš´ì˜ í†µê³„ ë¶„ì„</li>
                        <li><strong>ë³´ìœ  ë° ì´ìš©ê¸°ê°„:</strong> ë³µì§€ê¸°ê¸ˆ ìš´ì˜ ê·œì • ë° ê´€ë ¨ ë²•ë ¹(ê·¼ë¡œë³µì§€ê¸°ë³¸ë²• ë“±)ì— ë”°ë¥¸ ë³´ì¡´ ê¸°ê°„ ì¢…ë£Œ ì‹œê¹Œì§€</li>
                    </ul>
                    <p class="mb-0 text-muted">â€» ê·€í•˜ëŠ” ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ëŒ€í•œ ë™ì˜ë¥¼ ê±°ë¶€í•  ê¶Œë¦¬ê°€ ìˆìŠµë‹ˆë‹¤. ë‹¤ë§Œ, ë™ì˜ë¥¼ ê±°ë¶€í•  ê²½ìš° ë³µì§€ê¸°ê¸ˆ ì§€ì› ì‹ ì²­ ë° ì§€ê¸‰ì´ ì œí•œë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
                </div>
                <div class="card-footer bg-white border-top-0">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="privacyConsent" name="privacy_consent" required>
                        <label class="form-check-label fw-bold" for="privacyConsent">
                            ìœ„ì˜ ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤. (í•„ìˆ˜)
                        </label>
                    </div>
                </div>
            </div>

            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-lg text-white shadow fw-bold" style="background-color: #fd79a8;">
                    {% if data and data.app_id %} <i class="bi bi-check2-circle"></i> ëª¨ì„±ë³´í˜¸ ìˆ˜ì • ì™„ë£Œ {% else %} <i class="bi bi-send-fill"></i> ëª¨ì„±ë³´í˜¸ ì§€ì› ì‹ ì²­ {% endif %}
                </button>
                <a href="/my_status" class="btn btn-outline-secondary">ì·¨ì†Œí•˜ê³  ëŒì•„ê°€ê¸°</a>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById('maternityForm').onsubmit = async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);

        try {
            const res = await fetch('/submit', { method: 'POST', body: formData });
            if (!res.ok) {
                const errorText = await res.text();
                throw new Error(`ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜ (${res.status}): ${errorText.substring(0, 100)}`);
            }
            const result = await res.json();
            
            if(result.status === 'success') {
                alert(result.message || 'ëª¨ì„±ë³´í˜¸ ì§€ì› ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = '/my_status';
            } else {
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + result.message);
            }
        } catch (err) {
            console.error('Submission error:', err);
            alert('ì œì¶œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + err.message);
        }
    };
</script>
</body>
</html>
