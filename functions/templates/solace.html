<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìœ„ë¡œê¸ˆ ì§€ì› ì‹ ì²­ - LOFA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background: #f8f9fa; padding: 30px; font-family: 'Malgun Gothic', sans-serif; }
        .form-card { background: white; border-radius: 15px; padding: 40px; box-shadow: 0 5px 20px rgba(0,0,0,0.1); max-width: 800px; margin: auto; }
        .section-title { border-left: 5px solid #6c757d; padding-left: 15px; margin-bottom: 25px; font-weight: bold; color: #495057; }
        .info-box { background: #f8f9fa; border: 1px solid #dee2e6; padding: 15px; border-radius: 10px; font-size: 0.9rem; color: #666; }
    </style>
</head>
<body>

<div class="form-card shadow">
    <h3 class="text-center fw-bold text-secondary mb-4">
        {% if data and data.app_id %} 
            <i class="bi bi-pencil-square"></i> ìœ„ë¡œê¸ˆ ì‹ ì²­ ìˆ˜ì • 
        {% else %} 
            ğŸ©¹ ìœ„ë¡œê¸ˆ ì§€ì› ì‹ ì²­ì„œ 
        {% endif %}
    </h3>

    <form id="welfareForm" enctype="multipart/form-data">
        <input type="hidden" name="app_id" value="{{ data.app_id if data and data.app_id else '' }}">
        <input type="hidden" name="type" value="ìœ„ë¡œê¸ˆì§€ì›">
        
        <div class="section-title">1. ì‹ ì²­ì¸ ì •ë³´</div>
        <div class="row g-3 mb-4">
            <div class="col-md-4">
                <label class="fw-bold small">ì„±ëª…</label>
                <input type="text" name="user_name" class="form-control bg-light" value="{{ data.ì„±ëª… if data else user_name }}" readonly>
            </div>
            <div class="col-md-4">
                <label class="fw-bold small">ì‚¬ë²ˆ</label>
                <input type="text" name="user_id" class="form-control bg-light" value="{{ data.ì‚¬ë²ˆ if data else user_id }}" readonly>
            </div>
            <div class="col-md-4">
                <label class="fw-bold small">ë¶€ì„œ</label>
                <input type="text" name="user_dept" class="form-control bg-light" value="{{ data.ë¶€ì„œ if data else user_dept }}" readonly>
            </div>
            <div class="col-md-4">
                <label class="fw-bold small">ì§ê¸‰</label>
                <input type="text" name="position" class="form-control bg-light" value="{{ data.ì§ê¸‰ if data else user_rank }}" readonly>
            </div>
            <div class="col-md-4">
                <label class="fw-bold small">ì…ì‚¬ì¼</label>
                <input type="text" name="joinDate" class="form-control bg-light" value="{{ data.ì…ì‚¬ì¼ if data else user_join_date }}" readonly>
            </div>
            <div class="col-md-4">
                <label class="fw-bold small">ì „í™”ë²ˆí˜¸</label>
                <input type="text" name="phone" class="form-control bg-light" value="{{ data.ì „í™”ë²ˆí˜¸ if data else '' }}" readonly required>
            </div>
        </div>

        <div class="section-title">2. ìœ„ë¡œê¸ˆ ìƒì„¸ë‚´ìš©</div>
        <div class="row g-3 mb-4">
            <div class="col-md-12">
                <label class="fw-bold text-secondary small">ìœ„ë¡œ êµ¬ë¶„ (ëŒ€ìƒ)</label>
                <select name="target_name" class="form-select" required>
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="ë³¸ì¸ ì§ˆë³‘/ìƒí•´" {% if data and data.ëŒ€ìƒìì„±ëª… == 'ë³¸ì¸ ì§ˆë³‘/ìƒí•´' %}selected{% endif %}>ë³¸ì¸ ì§ˆë³‘/ìƒí•´</option>
                    <option value="ê°€ì¡± ì§ˆë³‘/ìƒí•´" {% if data and data.ëŒ€ìƒìì„±ëª… == 'ê°€ì¡± ì§ˆë³‘/ìƒí•´' %}selected{% endif %}>ê°€ì¡± ì§ˆë³‘/ìƒí•´</option>
                    <option value="ì¬ë‚œ í”¼í•´" {% if data and data.ëŒ€ìƒìì„±ëª… == 'ì¬ë‚œ í”¼í•´' %}selected{% endif %}>ì¬ë‚œ í”¼í•´</option>
                    <option value="ê¸°íƒ€" {% if data and data.ëŒ€ìƒìì„±ëª… == 'ê¸°íƒ€' %}selected{% endif %}>ê¸°íƒ€</option>
                </select>
            </div>
            <div class="col-md-12">
                <label class="fw-bold small">êµ¬ì²´ì ì¸ ì‚¬ìœ </label>
                <textarea name="detail_text" class="form-control" rows="3" placeholder="ìœ„ë¡œê¸ˆ ì‹ ì²­ì„ ìœ„í•œ êµ¬ì²´ì ì¸ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”." required>{{ data.ì„¸ë¶€ë‚´ìš© if data else '' }}</textarea>
            </div>
            <div class="col-md-6">
                <label class="fw-bold text-primary small">ì‹ ì²­ ê¸ˆì•¡</label>
                <div class="input-group">
                    <input type="number" name="amount" class="form-control fw-bold text-end" value="{{ data.ì‹ ì²­ê¸ˆì•¡ if data else '' }}" required>
                    <span class="input-group-text text-primary fw-bold">ì›</span>
                </div>
            </div>
            <div class="col-md-6">
                <label class="fw-bold small">ì§€ê¸‰ ê³„ì¢Œ (ì€í–‰/ë²ˆí˜¸/ì˜ˆê¸ˆì£¼)</label>
                <input type="text" name="account" class="form-control" value="{{ data.ê³„ì¢Œë²ˆí˜¸ if data else '' }}" required>
            </div>

            <div class="col-12 mt-3">
                <label class="fw-bold small"><i class="bi bi-paperclip"></i> ì¦ë¹™ì„œë¥˜ ì²¨ë¶€ (ì§„ë‹¨ì„œ, ì‚¬ê³ ì‚¬ì‹¤ í™•ì¸ì„œ ë“±)</label>
                <input type="file" name="attachment" class="form-control">
                {% if data and data.ì²¨ë¶€íŒŒì¼ %}
                <div class="mt-2 small text-muted">í˜„ì¬ ì²¨ë¶€íŒŒì¼: <span class="text-secondary fw-bold">{{ data.ì²¨ë¶€íŒŒì¼ }}</span></div>
                {% endif %}
            </div>
        </div>

        <div class="info-box mb-4">
            <i class="bi bi-info-circle-fill"></i> 
            <b>ì•ˆë‚´ì‚¬í•­:</b> â€» ì²¨ë¶€ì„œë¥˜: 4ëŒ€ì¤‘ì¦ì§ˆí™˜(ì•”, ì‹¬ì¥ì§ˆí™˜, ë‡Œí˜ˆê´€ì§ˆí™˜, í¬ê·€ë‚œì¹˜ì„±) ë° ëŒ€í˜•ì‚¬ê³ ë¡œ ì¸í•œ ì˜êµ¬ì¥ì•  íŒì • ê´€ë ¨ ì§„ë‹¨ ì¦ë¹™ ì„œë¥˜
        </div>

        <div class="d-grid gap-2">
            <button type="submit" class="btn btn-secondary btn-lg shadow fw-bold text-white">
                {% if data and data.app_id %} 
                    <i class="bi bi-check2-circle"></i> ìˆ˜ì • ì™„ë£Œ ë° ì¬ì œì¶œ 
                {% else %} 
                    <i class="bi bi-send-fill"></i> ìœ„ë¡œê¸ˆ ì‹ ì²­ì„œ ì œì¶œí•˜ê¸° 
                {% endif %}
            </button>
            <a href="/my_status" class="btn btn-outline-secondary">ì·¨ì†Œí•˜ê³  ëŒì•„ê°€ê¸°</a>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.getElementById('welfareForm').onsubmit = async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);

        try {
            const res = await fetch('/submit', { 
                method: 'POST', 
                body: formData 
            });
            const result = await res.json();
            
            if(result.status === 'success') {
                alert(result.message || 'ìœ„ë¡œê¸ˆ ì§€ì› ì‹ ì²­ì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = '/my_status';
            } else {
                alert('ì˜¤ë¥˜ ë°œìƒ: ' + result.message);
            }
        } catch (err) {
            console.error(err);
            alert('ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    };
</script>
</body>
</html>