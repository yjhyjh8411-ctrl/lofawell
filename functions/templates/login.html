<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>LOFA ë³µì§€ê¸°ê¸ˆ ì‹œìŠ¤í…œ ë¡œê·¸ì¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f0f2f5; display: flex; align-items: center; justify-content: center; height: 100vh; font-family: 'Malgun Gothic', sans-serif; }
        .login-card { background: white; padding: 40px; border-radius: 15px; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px; }
        .logo { font-size: 2rem; font-weight: bold; color: #fd8d0d; margin-bottom: 20px; text-align: center; }
    </style>
</head>
<body>

<div class="login-card shadow">
    <div class="logo">LOFA <span class="text-dark" style="font-size: 1.2rem;">ë³µì§€ê¸°ê¸ˆ</span></div>
    <h5 class="text-center mb-4 text-secondary lh-base">
        ê³„ì •ì´ ì—†ëŠ” ê²½ìš° <br> 
        íšŒì› ê°€ì… í›„ ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”
    </h5>    
    <form id="loginForm">
        <div class="mb-3">
            <label class="form-label fw-bold">ì‚¬ë²ˆ (ì•„ì´ë””)</label>
            <input type="text" name="employeeId" class="form-control form-control-lg" placeholder="ì‚¬ë²ˆì„ ì…ë ¥í•˜ì„¸ìš”" required>
        </div>
        <div class="mb-4">
            <label class="form-label fw-bold">ë¹„ë°€ë²ˆí˜¸</label>
            <input type="password" name="password" class="form-control form-control-lg" placeholder="ë¹„ë°€ë²ˆí˜¸" required>
        </div>
        <div class="d-grid mb-3">
            <button type="submit" class="btn btn-primary btn-lg fw-bold shadow-sm">ë¡œê·¸ì¸</button>
        </div>
    </form>

    <div class="mt-4 text-center border-top pt-4">
        <span class="text-muted fs-5">ì•„ì§ ê³„ì •ì´ ì—†ìœ¼ì‹ ê°€ìš”?</span><br>
        
        <a href="/signup" class="text-primary fw-bold mt-2 d-inline-block" style="text-decoration: none; font-size: 1.2rem;">
            <i class="bi bi-person-plus-fill me-1"></i> ì‹ ê·œ íšŒì›ê°€ì… í•˜ê¸°
        </a>
    </div>

    <!-- Announcements & Rules Section -->
    <div class="mt-4 pt-4 border-top">
        <div class="mb-4">
            <h6 class="fw-bold mb-2 text-primary">ğŸ“¢ ê³µì§€ì‚¬í•­</h6>
            <div id="notice-content" class="bg-light p-3 rounded-3 small text-muted" style="max-height: 100px; overflow-y: auto; white-space: pre-wrap;">
                ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
            </div>
        </div>
        <div>
            <h6 class="fw-bold mb-2 text-secondary">ğŸ“œ ë³µì§€ê¸°ê¸ˆ ê·œì •ì§‘</h6>
            <button type="button" class="btn btn-sm btn-outline-secondary w-100" data-bs-toggle="modal" data-bs-target="#rulesModal">
                ê·œì •ì§‘ ìƒì„¸ ë³´ê¸°
            </button>
        </div>
    </div>

    <!-- QR Code Section -->
    <div class="mt-4 pt-4 border-top text-center">
        <p class="text-secondary small mb-3">ëª¨ë°”ì¼ì—ì„œ ì ‘ì†í•˜ë ¤ë©´ ì•„ë˜ QRì½”ë“œë¥¼ ìŠ¤ìº”í•˜ì„¸ìš”</p>
        <div id="qrcode" class="d-flex justify-content-center"></div>
    </div>
</div>

<!-- Rules Modal -->
<div class="modal fade" id="rulesModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold">LOFA ë³µì§€ê¸°ê¸ˆ ê·œì •ì§‘</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="rules-content" style="white-space: pre-wrap; font-size: 0.95rem; line-height: 1.6; color: #444;">
                    ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ë‹«ê¸°</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script>
    // Fetch and display settings
    async function loadSettings() {
        try {
            const res = await fetch('/api/settings');
            const data = await res.json();
            document.getElementById('notice-content').innerText = data.notice || "ê³µì§€ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤.";
            document.getElementById('rules-content').innerText = data.rules || "ê·œì •ì§‘ ë‚´ìš©ì´ ì•„ì§ ë“±ë¡ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
        } catch (err) {
            console.error("Settings load error:", err);
            document.getElementById('notice-content').innerText = "ë°ì´í„° ë¡œë”© ì‹¤íŒ¨";
        }
    }

    // Generate QR code for the current homepage
    window.addEventListener('load', () => {
        loadSettings();
        new QRCode(document.getElementById("qrcode"), {
            text: window.location.origin,
            width: 128,
            height: 128,
            colorDark : "#000000",
            colorLight : "#ffffff",
            correctLevel : QRCode.CorrectLevel.H
        });
    });

    document.getElementById('loginForm').onsubmit = async (e) => {
        e.preventDefault();
        const formData = new FormData(e.target);
        
        try {
            const res = await fetch('/login_process', { method: 'POST', body: formData });
            const result = await res.json();
            
            if (result.status === 'success') {
                alert('ë¡œê·¸ì¸ ì„±ê³µ! ' + (result.is_admin ? 'ê´€ë¦¬ì' : 'ë©”ì¸') + ' í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
                // ê´€ë¦¬ìë¼ë©´ ê´€ë¦¬ì í˜ì´ì§€ë¡œ, ì¼ë°˜ ì§ì›ì€ ë©”ì¸ìœ¼ë¡œ ì´ë™
                if (result.is_admin) {
                    location.href = '/admin';
                } else {
                    location.href = '/main';
                }
            } else {
                alert(result.message);
            }
        } catch (err) {
            alert('ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    };
</script>
</body>
</html>