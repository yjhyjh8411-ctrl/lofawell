<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìƒí™œë³µì§€ ì§€ì› ì‹ ì²­ - LOFA</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        body { background-color: #f4f7f9; padding: 40px 0; font-family: 'Malgun Gothic', sans-serif; }
        .form-card { background: white; border-radius: 15px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); max-width: 800px; margin: auto; }
        .header-line { border-left: 5px solid #f39c12; padding-left: 15px; margin-bottom: 30px; }
        .section-title { font-size: 1.1rem; font-weight: bold; color: #e67e22; margin-top: 25px; margin-bottom: 15px; border-bottom: 2px solid #e9ecef; padding-bottom: 5px; }
        .info-text { background-color: #fef9e7; border-radius: 10px; padding: 15px; font-size: 0.9rem; color: #444; border: 1px solid #f9e79f; }
    </style>
</head>
<body>
<div class="container">
    <div class="form-card shadow">
        <div class="header-line">
            <h2 class="fw-bold">{% if data %} ğŸŠ ìƒí™œë³µì§€ ì§€ì› ìˆ˜ì • {% else %} ğŸŠ ìƒí™œë³µì§€ ì§€ì› ì‹ ì²­ì„œ {% endif %}</h2>
            <p class="text-muted mb-0">í•™ì› ìˆ˜ê°•ë£Œ, ë„ì„œ êµ¬ì…ë¹„ ë“± ì„ì§ì›ì˜ ìê¸°ê³„ë°œ ë° ìƒí™œ ë³µì§€ ì§€ì› ì–‘ì‹ì…ë‹ˆë‹¤.</p>
        </div>

        <form id="lifeWelfareForm" enctype="multipart/form-data">
            <input type="hidden" name="app_id" value="{{ data.app_id if data else '' }}">
            <input type="hidden" name="type" value="ìƒí™œë³µì§€ì§€ì›">

            <div class="section-title">1. ì‹ ì²­ì¸ ì •ë³´</div>
            <div class="row g-3 mb-4">
                <div class="col-md-4">
                    <label class="fw-bold small">ì„±ëª…</label>
                    <input type="text" name="user_name" class="form-control bg-light" value="{{ data.ì„±ëª… if data else user_name }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ì‚¬ë²ˆ</label>
                    <input type="text" name="user_id" class="form-control bg-light" value="{{ data.ì‚¬ë²ˆ if data else user_id }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ë¶€ì„œ</label>
                    <input type="text" name="user_dept" class="form-control bg-light" value="{{ data.ë¶€ì„œ if data else user_dept }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ì§ê¸‰</label>
                    <input type="text" name="position" class="form-control bg-light" value="{{ data.ì§ê¸‰ if data else user_rank }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ì…ì‚¬ì¼</label>
                    <input type="text" name="joinDate" class="form-control bg-light" value="{{ data.ì…ì‚¬ì¼ if data else user_join_date }}" readonly>
                </div>
                <div class="col-md-4">
                    <label class="fw-bold small">ì „í™”ë²ˆí˜¸</label>
                    <input type="text" name="phone" class="form-control" value="{{ data.ì „í™”ë²ˆí˜¸ if data else '' }}" placeholder="010-0000-0000" required>
                </div>
            </div>

            <div class="section-title">2. ì§€ì› ì‹ ì²­ ë‚´ìš©</div>
            <div class="row g-3">
                <div class="col-md-4">
                    <label class="form-label fw-bold small">ëŒ€ìƒì ì„±ëª…</label>
                    <input type="text" name="target_name" class="form-control" value="{{ data.ëŒ€ìƒìì„±ëª… if data else 'ë³¸ì¸' }}" required>
                </div>
                <div class="col-md-8">
                    <label class="form-label fw-bold small">ì§€ì› í•­ëª© ë¶„ë¥˜ (ìˆ˜ê°•ë£Œ, ë„ì„œë¹„ ë“±)</label>
                    <input type="text" name="detail_text" class="form-control" value="{{ data.ì„¸ë¶€ë‚´ìš© if data else '' }}" placeholder="ì˜ˆ: ì˜ì–´ í•™ì› ìˆ˜ê°•ë£Œ" required>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold small text-orange" style="color: #e67e22;">ì‹ ì²­ ê¸ˆì•¡</label>
                    <div class="input-group">
                        <input type="number" name="amount" class="form-control fw-bold" value="{{ data.ì‹ ì²­ê¸ˆì•¡ if data else 0 }}" required>
                        <span class="input-group-text">ì›</span>
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label fw-bold small">ì§€ê¸‰ ê³„ì¢Œë²ˆí˜¸</label>
                    <input type="text" name="account" class="form-control" value="{{ data.ê³„ì¢Œë²ˆí˜¸ if data else '' }}" placeholder="ì€í–‰ / ê³„ì¢Œ / ì˜ˆê¸ˆì£¼" required>
                </div>
                
                <div class="col-12 mt-3">
                    <label class="form-label fw-bold small"><i class="bi bi-paperclip"></i> ì¦ë¹™ì„œë¥˜ ì²¨ë¶€ (ì˜ìˆ˜ì¦, ìˆ˜ê°•í™•ì¸ì„œ ë“±)</label>
                    <input type="file" name="attachment" class="form-control">
                    {% if data and data.ì²¨ë¶€íŒŒì¼ %}
                    <div class="mt-2 small text-muted">ê¸°ì¡´ íŒŒì¼: <span class="text-warning fw-bold">{{ data.ì²¨ë¶€íŒŒì¼ }}</span></div>
                    {% endif %}
                </div>
            </div>

            <div class="section-title">3. ì¦ë¹™ ì•ˆë‚´</div>
            <div class="info-text mb-4 shadow-sm">
                <i class="bi bi-info-circle-fill text-warning"></i> <b>ì œì¶œ ì¦ë¹™:</b> 
                ì‹¤ì œ ì§€ì¶œ ì¦ë¹™ ì„œë¥˜(ì˜ìˆ˜ì¦ ë“±)ë¥¼ ë°˜ë“œì‹œ ìŠ¤ìº”í•˜ì—¬ ì²¨ë¶€í•´ ì£¼ì„¸ìš”. (íŒŒì¼ëª…ì€ ìë™ìœ¼ë¡œ ì‚¬ë²ˆ_ì„±ëª… í˜•ì‹ì´ ì ìš©ë©ë‹ˆë‹¤.)
            </div>

            <div class="d-grid gap-2">
                <button type="submit" class="btn btn-warning btn-lg text-white shadow fw-bold" style="background-color: #f39c12; border: none;">
                    {% if data and data.app_id %} <i class="bi bi-pencil-square"></i> ìƒí™œë³µì§€ ìˆ˜ì • ì™„ë£Œ {% else %} <i class="bi bi-send-fill"></i> ìƒí™œë³µì§€ ì§€ì› ì‹ ì²­ì„œ ì œì¶œ {% endif %}
                </button>



                <a href="/my_status" class="btn btn-outline-secondary">ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
document.getElementById('lifeWelfareForm').onsubmit = async (e) => {
    e.preventDefault();
    
    // ğŸ’¡ íŒŒì¼ì„ í¬í•¨í•œ ëª¨ë“  ë°ì´í„°ë¥¼ ì „ì†¡í•˜ê¸° ìœ„í•´ FormDataë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
    const formData = new FormData(e.target);

    try {
        const res = await fetch('/submit', { 
            method: 'POST', 
            body: formData 
        });
        const result = await res.json();
        
        if(result.status === 'success') {
            alert(result.message || 'ìƒí™œë³µì§€ ì‹ ì²­ì´ ì •ìƒì ìœ¼ë¡œ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = '/my_status'; 
        } else {
            alert('ì˜¤ë¥˜ ë°œìƒ: ' + result.message);
        }
    } catch (err) {
        console.error(err);
        alert('ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    }
};
</script>
</body>
</html>